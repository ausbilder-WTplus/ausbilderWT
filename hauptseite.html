<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WT-Ausbilder</title>
<style>
:root {
  --bg:#000; --text:#fff; --accent-bg:#fff; --accent-text:#000;
  --card:#111; --border:#333; --muted:#aaa; --hover:#1a1a1a; --red:#f44;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column}
header{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;border-bottom:1px solid var(--border)}
header img{height:60px}
main{display:flex;flex:1;min-height:0}

/* ================= NAVIGATION ================= */
nav{
  width:260px;background:var(--card);border-right:1px solid var(--border);
  padding:16px;display:flex;flex-direction:column;gap:8px;
  position:sticky;top:0;height:calc(100vh - 80px);overflow-y:auto;
}
nav button, nav .submenu-toggle{
  background:transparent;color:var(--text);text-align:left;border:none;
  padding:10px 14px;font-size:15px;border-radius:8px;cursor:pointer;
  display:flex;align-items:center;gap:8px;width:100%;
  transition:background .15s,transform .1s;
}
nav button:hover, nav .submenu-toggle:hover{
  background:var(--hover);transform:translateX(2px);
}
.submenu{
  display:none;flex-direction:column;padding-left:16px;gap:4px;margin-top:4px;
}
.submenu button{font-size:14px;color:var(--muted);}
.submenu.open{display:flex;}
.logout-container{margin-top:auto;padding:12px;}
.logout-btn{
  background:var(--red);color:#fff;border:none;border-radius:8px;
  padding:10px 20px;font-size:16px;font-weight:bold;cursor:pointer;width:100%;
}
.logout-btn:hover{background:#d22;}
.settings-btn{
  background:transparent;color:var(--muted);
  display:flex;align-items:center;gap:8px;justify-content:center;
  border:none;padding:10px;font-size:15px;cursor:pointer;width:100%;
}
.settings-btn:hover{color:#fff;transform:rotate(5deg);}

/* ================= CONTENT ================= */
.content{flex:1;padding:24px;overflow:auto}
.top-actions{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:16px}
.btn{background:var(--accent-bg);color:var(--accent-text);border:none;padding:10px 16px;border-radius:10px;font-weight:bold;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.3)}
.btn.ghost{background:transparent;color:#fff;border:1px solid var(--border);box-shadow:none}
.pill{background:#0b0b0b;color:#fff;border:1px solid var(--border);border-radius:999px;padding:8px 12px;font-size:14px}

.ticker{margin-top:16px;width:100%;overflow:hidden;border-radius:8px;border:1px solid var(--border);padding:10px;background:rgba(255,255,255,.05)}
.ticker-inner{display:inline-block;white-space:nowrap;padding-left:100%;font-size:16px}
@keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}
.ticker-inner.animate{animation:scroll linear infinite;animation-duration:12s}

.calendar-wrap{margin:18px 0;width:100%;height:520px;display:none}
.calendar-wrap iframe{width:100%;height:100%;border:none;border-radius:8px;background:#fff}

@media(max-width:600px){
  nav{display:none}
  .menu-open nav{display:flex;position:fixed;left:0;top:80px;z-index:999;background:#111;width:80%;max-width:260px;height:calc(100vh - 80px)}
}
</style>
</head>
<body>
<header>
  <img id="logo-left" src="pluslogo.png" alt="Logo links">
  <img id="logo-center" src="faust.jpg" alt="Logo Mitte">
  <img id="logo-right" src="melsungen.jpg" alt="Logo rechts">
</header>

<main>
  <!-- ===== NAVIGATION ===== -->
  <nav id="navMenu">
    <button id="profileBtn">👤 Mein Profil</button>

    <!-- TRAINER-MENÜ -->
    <button class="submenu-toggle" id="trainerToggle">📚 Trainer ▾</button>
    <div class="submenu" id="trainerSub">
      <button id="oneNoteBtn">📓 OneNote</button>
      <button id="templatesBtn">📂 Vorlagen</button>
      <button id="driveBtn">💾 Drive</button>
      <button onclick="location.href='links.html'">🧰 Trainingsausrüstung</button>
      <button onclick="location.href='spiele.html'">🎲 Spiele</button>
      <button onclick="location.href='bilder.html'">🖼️ Bilder</button>
      <button onclick="location.href='videos.html'">🎥 Videos</button>
      <button onclick="location.href='trainingszeiten.html'">🕒 Trainingszeiten</button>
      <button onclick="location.href='schuluebersicht.html'">🏫 Schulübersicht</button>
      <button onclick="location.href='anleitungen.html'">📖 Anleitungen</button>
      <button onclick="location.href='checkliste.html'">✅ Checkliste</button>
    </div>

    <!-- ADMIN-MENÜ -->
    <button class="submenu-toggle" id="adminToggle" style="display:none;">🛠️ Admin ▾</button>
    <div class="submenu" id="adminSub">
      <button id="calendarBtn">📅 Kalender</button>
      <button onclick="location.href='registrierung.html'">🧾 Registrierung</button>
      <button onclick="location.href='session-admin.html'">🏋️‍♂️ Trainingstermin erstellen</button>
    </div>

    <button data-role="trainer,admin,si-fu" onclick="location.href='attend.html'">✅ Ausbilder-Check-in</button>
    <button onclick="location.href='passwort-aendern.html'">🔑 Passwort ändern</button>

    <div class="logout-container">
      <button class="settings-btn" id="settingsBtn">⚙️ Einstellungen</button>
      <button class="logout-btn" id="logoutBtn">🚪 Logout</button>
    </div>
  </nav>

  <!-- ===== CONTENT ===== -->
  <div class="content">
    <div class="top-actions">
      <button class="btn" id="menuToggle">☰ Menü</button>
      <button class="btn ghost" id="chooseSchoolBtn">Schule: <span id="chooseSchoolLabel">MASTER</span></button>
      <span id="activeRolePill" class="pill" style="display:none"></span>
    </div>

    <h1>Willkommen bei WT-Ausbilder</h1>
    <p>Wähle links im Menü einen Bereich aus. Oben kannst du die Schule wählen.</p>

    <div class="ticker"><div id="tickerInner" class="ticker-inner">Lade Newsticker…</div></div>

    <div class="calendar-wrap" id="calendarWrap">
      <iframe id="calendarFrame" src="about:blank" title="Trainingskalender"></iframe>
    </div>
  </div>
</main>

<!-- ===== Firebase & Scripts ===== -->
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>

<script>
if(!firebase.apps.length)firebase.initializeApp(window.firebaseConfig);
const auth=firebase.auth(),db=firebase.firestore();
auth.setPersistence(firebase.auth.Auth.Persistence.SESSION);

// Submenüs toggeln
function setupToggle(toggleId, submenuId){
  const t=document.getElementById(toggleId);
  const s=document.getElementById(submenuId);
  if(!t||!s)return;
  t.addEventListener("click",()=>s.classList.toggle("open"));
}
setupToggle("trainerToggle","trainerSub");
setupToggle("adminToggle","adminSub");

// Menü / Logout / Profil / Einstellungen
document.getElementById("menuToggle").onclick=()=>document.body.classList.toggle("menu-open");
document.getElementById("logoutBtn").onclick=async()=>{await auth.signOut();sessionStorage.clear();location.href="index.html"};
document.getElementById("profileBtn").onclick=()=>location.href="profil.html";
document.getElementById("settingsBtn").onclick=()=>location.href="einstellungen.html";

// Hilfsfunktionen
function preloadAndSet(img,u){const t=new Image();t.onload=()=>img.src=u;t.src=u;}
function applyHeaderBySchool(s){const h=document.querySelector("header");h.innerHTML=`<img id="logo-left" src="pluslogo.png"><img id="logo-center" src="faust.jpg"><img id="logo-right" src="melsungen.jpg">`;if(!s||s.toLowerCase()==="master")return;const b=`logos/${s.toLowerCase()}`;preloadAndSet(document.getElementById("logo-left"),`${b}/logo-left.jpg`);preloadAndSet(document.getElementById("logo-center"),`${b}/logo-center.jpg`);preloadAndSet(document.getElementById("logo-right"),`${b}/logo-right.jpg`);}
const normalize=r=>{r=(r||"").toLowerCase();if(["administrator","admins","adminstrator"].includes(r))r="admin";if(["trainer/in","trainerin","coach"].includes(r))r="trainer";if(["si-fu","sifu","si fu","si‐fu","si‒fu"].includes(r))r="si-fu";return r;};

// Auth Flow
auth.onAuthStateChanged(async user=>{
  if(!user){location.replace("index.html");return;}
  let role=(sessionStorage.getItem("role")||"").trim();
  let school=(sessionStorage.getItem("school")||"").trim();
  if(!role||!school){
    const p=await db.collection("rollen").doc(user.uid).get();
    if(p.exists){const d=p.data()||{};role=normalize(d.role);school=(d.school||"").trim();sessionStorage.setItem("role",role);sessionStorage.setItem("school",school);}
  }

  const rolePill=document.getElementById("activeRolePill");
  rolePill.textContent="Rolle: "+(role||"–");
  rolePill.style.display="inline-block";

  // Admin-Menü sichtbar machen
  if(["admin","si-fu"].includes(role)) adminToggle.style.display="flex";

  const active=(sessionStorage.getItem("activeSchool")||school||"MASTER").trim();
  document.getElementById("chooseSchoolLabel").textContent=active.toUpperCase();
  applyHeaderBySchool(active);

  // Schule auswählen
  document.getElementById("chooseSchoolBtn").onclick=()=>{
    document.getElementById("chooseSchoolDlg").style.display="flex";
    document.getElementById("schoolSelect").value=active;
  };
});

// Schulwahl-Dialog
document.addEventListener("click",e=>{
  if(e.target.id==="dlgCancel") document.getElementById("chooseSchoolDlg").style.display="none";
  if(e.target.id==="dlgApply"){
    const val=document.getElementById("schoolSelect").value;
    sessionStorage.setItem("activeSchool",val);
    document.getElementById("chooseSchoolLabel").textContent=val.toUpperCase();
    applyHeaderBySchool(val);
    document.getElementById("chooseSchoolDlg").style.display="none";
  }
});
</script>

<!-- ===== SCHULWAHL-DIALOG ===== -->
<div class="scope-dialog-backdrop" id="chooseSchoolDlg"
     style="position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:999">
  <div class="scope-dialog" role="dialog" aria-modal="true"
       style="width:92%;max-width:460px;background:#111;color:#fff;border:1px solid #333;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.6);padding:16px;">
    <h3 style="margin:0 0 10px;font-size:20px;">Schule wählen</h3>
    <select id="schoolSelect" style="width:100%;background:#000;color:#fff;border:1px solid #333;border-radius:10px;padding:10px 12px">
      <option value="MASTER">MASTER</option>
      <option value="MELSUNGEN">MELSUNGEN</option>
      <option value="KASSEL">KASSEL</option>
      <option value="BAUNATAL">BAUNATAL</option>
    </select>
    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
      <button id="dlgCancel" class="btn ghost">Abbrechen</button>
      <button id="dlgApply" class="btn">Übernehmen</button>
    </div>
  </div>
</div>
</body>
</html>
